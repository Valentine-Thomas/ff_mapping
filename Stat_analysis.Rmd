---
title: "FF mapping project_Statistics"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache.rebuild = TRUE)
```
*Ctrl+Alt+I*
#useful packages
```{r}
library(ggplot2) 
library(ggpubr)
library(rstatix) 
library(dplyr)
library(plyr)
library(matrixStats)
```


# charge the datasets

```{r}
setwd('~/Analysis/POI_replicats/')

#medium group
Fus1<-read.csv('Fus1/aligned_trajectories/Data/dir_distance_P_POI.csv')
Exo70<-read.csv('Exo70/aligned_trajectories/Data/dir_distance_P_POI.csv')
Exo84<-read.csv('Exo84/aligned_trajectories/Data/dir_distance_P_POI.csv')

#Proximal group
Prm1<-read.csv('Prm1/aligned_trajectories/Data/dir_distance_P_POI.csv')
Dni1<-read.csv('Dni1/aligned_trajectories/Data/dir_distance_P_POI.csv')
Dni2<-read.csv('Dni2/aligned_trajectories/Data/dir_distance_P_POI.csv')

#Distal group
Cdc8<-read.csv('Cdc8/aligned_trajectories/Data/dir_distance_P_POI.csv')
Myo51<-read.csv('Myo51/aligned_trajectories/Data/dir_distance_P_POI.csv')

```

# Are replicats significantly different

```{r}
# permutation test
```

#Prepare datasets for statistical test
need 3 subgroups containing medians [-60,-40[ (60 to 42), [-40,-20] (39 to 21), [-20,0](18 to 0) for each event of each replicate 


```{r}
Med.subset=function(dataframe)
{
matrix=data.matrix(dataframe)
med.early=rowMedians(matrix,cols=5:11, na.rm=TRUE)
id1=which(med.early=='NaN')
med.early[id1]<-'NA'
med.early=as.numeric(med.early)
med.early=as.data.frame(med.early)
med.mid=rowMedians(matrix,cols=12:18, na.rm=TRUE)
id2=which(med.mid=='NaN')
med.mid[id2]<-'NA'
med.mid=as.numeric(med.mid)
med.mid=as.data.frame(med.mid)
med.late=rowMedians(matrix, cols=19:25, na.rm=TRUE)
id3=which(med.late=='NaN')
med.late[id3]<-'NA'
med.late=as.numeric(med.late)
med.late=as.data.frame(med.late)
df=cbind(dataframe,med.early,med.mid,med.late)

return(df)
}

#Mid grouo
Fus1=Med.subset(Fus1)
Exo70=Med.subset(Exo70)
Exo84=Med.subset(Exo84)

#Proximal group
Prm1=Med.subset(Prm1)
Dni1=Med.subset(Dni1)
Dni2=Med.subset(Dni2)

#Distal group
Cdc8=Med.subset(Cdc8)
Myo51=Med.subset(Myo51)
```
# Statistical tests

getting id of event from the different replicates

```{r}
# compare distribution for each POI between each replicates
index_rep=function(df){
  id=list()
  for (i in 1:n_distinct(df$Replicat)) { 
    id[[i]]<-assign(paste0("index", i), which(df$Replicat==i))
  }
  return(id)
}

#mid group
Rep.id.Fus1<-index_rep(Fus1)
Rep.id.Exo70<-index_rep(Exo70)
Rep.id.Exo84<-index_rep(Exo84)

#Proximal group
Rep.id.Prm1<-index_rep(Prm1)
Rep.id.Dni1<-index_rep(Dni1)
Rep.id.Dni2<-index_rep(Dni2)

#Distal group
Rep.id.Myo51<-index_rep(Myo51)
Rep.id.Cdc8<-index_rep(Cdc8)
```

# Graphical representation
boxplot of medians at different fusion stage, all and by replicats
Notes: could be interesting to look at violin plots too => asks Melvin if he knows how to do them 
```{r}
par(mfrow=c(1,3))

box.rep=function(df,id.list){
  n=length(id.list)+1
  par(mfrow=c(1,n))
  names=c("med.early","med.mid","med.late")
  boxplot(df[,names])
    for (i in seq_along(id.list)){
      boxplot(df[id.list[[i]],names])
    }
}

box.rep(Fus1,Rep.id.Fus1)
box.rep(Exo70,Rep.id.Exo70)
box.rep(Exo84,Rep.id.Exo84)

box.rep(Prm1,Rep.id.Prm1)
box.rep(Dni1,Rep.id.Dni1)
box.rep(Dni2,Rep.id.Dni2)

box.rep(Cdc8,Rep.id.Cdc8)
box.rep(Myo51,Rep.id.Myo51)
```

#Paired t-test => each median is dependant on previous one
most of the data do not follow normal distribution => go to non parametric tests
Wilcoxon signed ranks test


```{r echo=TRUE, paged.print=FALSE, results='markup'}
#test data normality
test.norm=function(df){
print(ddply(df, .(Replicat), summarise, ntest =
   shapiro.test(med.early)))
print(ddply(df, .(Replicat), summarise, ntest =
   shapiro.test(med.mid)))
print(ddply(df, .(Replicat), summarise, ntest =
   shapiro.test(med.late)))}

test.norm(Fus1)
test.norm(Exo70)
test.norm(Exo84)

test.norm(Prm1)
test.norm(Dni1)
test.norm(Dni2)

test.norm(Cdc8)
test.norm(Myo51)


 
```








